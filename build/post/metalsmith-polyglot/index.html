<!DOCTYPE html><html lang="en"><head><title>metalsmith-polyglot | Visualcosita</title><meta charset="utf-8"><meta name="viewport" content="width=device-width" initial-scale="1.0"><meta http-equiv="x-ua-compatible" content="ie=edge"><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/skeleton.css"><link rel="stylesheet" type="text/css" href="/css/main.css"><link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Raleway:400,600"><link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Ubuntu+Mono"><link rel="shortcut icon" type="image/png" href="/img/favicon.ico"></head><body><nav><ul class="navbar"><li class="navbar-item"><a href="/" id="navbar-title" class="nav-link">Visualcosita</a></li><li class="navbar-item u-pull-right"><ul class="navbar-container"><li class="navbar-item"><a href="https://twitter.com/fdoxyz" class="nav-link"><img src="/img/twitter.png"></a></li><li class="navbar-item"><a href="https://github.com/fdoxyz" class="nav-link"><img src="/img/github.png"></a></li><li class="navbar-item"><a href="/rss.xml" class="nav-link"><img src="/img/rss.png"></a></li><li class="navbar-item"> <a href="undefined" id="langToggler" class="nav-link">ES</a></li></ul></li></ul></nav><div id="content" class="container"><div class="article"><h2 class="article-title">metalsmith-polyglot</h2><div class="article-date">November 15th 2015</div><div class="article-content"><p>This is a simple plugin I made to help me translate a static website. My short description of Metalsmith is <em>&quot;a gulp-like pipe solution for processing/generating your files&quot;</em>, check out <a href="http://www.metalsmith.io/">their website</a> for a more accurate description. Also in my <a href="/post/sup-world">previous post</a> I referred to Metalsmith and a couple of beginner tutorial suggestions for first-timers. After <code>npm install metalsmith-polyglot --save</code> we can dive right into business.</p>
<h4 id="the-project-structure">The project structure</h4>
<p>For translating a whole blog, the structure to organize the content was the first thing to settle before starting to write anything else. With a homepage and a bunch of posts the general structure will be easy, url paths like <code>http://visualcosita.xyz/post/title</code> and for translations just add the language code prefix <code>http://visualcosita.xyz/es/post/title</code>. Easy right? Here&#39;s my project structure:</p>
<pre><code class="lang-js">src/
    content/
        index.md
        post/
            sup-world.md
            metalsmith-polyglot.md
    es/
        index.md
        post/
            sup-world.md
            metalsmith-polyglot.md
</code></pre>
<p>And part of my pipe:</p>
<pre><code class="lang-js">.use(markdown())
.use(excerpts())
.use(collections({
    posts: {
        pattern: &#39;content/post/**.html&#39;,
        sortBy: &#39;date&#39;,
        reverse: true
    },
    spanishPosts: {
        pattern: &#39;es/post/**.html&#39;,
        sortBy: &#39;date&#39;,
        reverse: true
    }
}))
.use(branch(&#39;content/post/**.html&#39;)
    .use(permalinks({
        pattern: &#39;post/:title&#39;
    }))
)
.use(branch(&#39;es/post/**.html&#39;)
    .use(permalinks({
        pattern: &#39;es/post/:title&#39;
    }))
)
.use(layouts({
    engine: &#39;jade&#39;,
    moment: moment
}))
</code></pre>
<p>What&#39;s going on here? Nothing special, a collection for each language. If the branch caught you off-guard, it just helps to output the content with nice permalinks. Neither of the <code>index.md</code> will be parsed by the permalinks plugin, they are not necessary because <code>/</code> and <code>/es</code> paths work niceley without any help since they will be named <code>index.html</code>. Finally there is <a href="http://jade-lang.com/">Jade</a> for templating.</p>
<p>Eveything works, life is awesome! Now I have both versions, the base language (en) and the translations to spanish working. <strong>How do I link them up?</strong> Modifying the url with JavaScript is an option, but what if I could avoid that and just <em>&quot;know&quot;</em> before hand where those files are? That&#39;d be great. Even better, also take into account if the translation exists or not to avoid having a script redirect me to a <code>404</code>.</p>
<h4 id="my-solution">My solution</h4>
<p>Parse the files, add some metadata to Metalsmith&#39;s pipe and also take advantage of the file structure in templating time to make a clean redirect. Stick <code>polyglot</code> right before the template engine, which might be handlebars or something else, in my case Jade.</p>
<pre><code class="lang-js">...
.use(branch(&#39;es/post/**.html&#39;)
    .use(permalinks({
        pattern: &#39;es/post/:title&#39;
    }))
)
.use(polyglot())
.use(layouts({
    engine: &#39;jade&#39;,
    moment: moment
}))
...
</code></pre>
<p>What will this help me with? A new variable in the metadata of each file with the following structure:</p>
<pre><code class="lang-js">&quot;post/sup-world.html&quot;: {
    ...
    translationPath : {
        en: &quot;/&quot;,
        es: &quot;/es/post/sup-world&quot;
    },
    ...
}
</code></pre>
<p>So what&#39;s so useful about it? I can know beforehand -during template rendering- the path (if there is one) of the translation for a file. The template navigation for this website looks like this:</p>
<pre><code class="lang-jade">//If anyone has a suggestion to fix this bothersome horizontal
//scroll issue, plz comment below, my css is not that solid yet

li.navbar-item
    - var langString = ((lang !== undefined) &amp;&amp; (lang === &quot;en&quot;)) ? &quot;ES&quot; : &quot;EN&quot;
    - var translatedUrl = ((lang !== undefined)  &amp;&amp; (lang === &quot;en&quot;)) ? translationPath.es : translationPath.en
    a(href=&quot;#{translatedUrl}&quot; class=&quot;nav-link&quot; id=&quot;langToggler&quot;) #{langString}
</code></pre>
<p>This is jade logic, but I think it should be pretty straight-foward. The <code>langString</code> is the text for the link, depending on the front matter inside the post. This is kinda specific to my scenario, but cooler ideas came to my mind if I wanted to build something scalable to more languages, and they are all compatible with polyglot&#39;s features. The jade variable <code>translatedUrl</code> takes the path from <code>translationPath.es</code> or <code>translationPath.en</code> inside the file&#39;s metadata. I use either one depending on what language I want to link to.</p>
<p>That&#39;s about all there is to it, more info can be found in the repo <a href="https://github.com/fdoxyz/metalsmith-polyglot">fdoxyz/metalsmith-polyglot</a> about ways to customize polyglot&#39;s execution. Stuff like setting a different base language, disabling permalinks and custom redirects when no translation is found (by default redirects to the homepage of translated language requested). Besides, <a href="https://github.com/fdoxyz/visualcosita">this blog</a> is open sourced, take a peek if you wish but keep in mind that much work is left to be done.</p>
</div></div></div><div id="footer"><script src="http://localhost:35729/livereload.js"></script></div></body></html>